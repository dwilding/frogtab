<!DOCTYPE html>
<html lang="en" data-theme="system">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Learn how to get started with Frogtab and explore Frogtab's features in detail">
    <title>Frogtab Help</title>
    <link rel="icon" href="/favicons/icon-16.png" sizes="16x16" type="image/png">
    <link rel="icon" href="/favicons/icon-32.png" sizes="32x32" type="image/png">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/icon-180-apple.png">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="stylesheet" href="/simple.min.css?sha1=713346e8ca6500a33f266eca1e1c7bafd070c8fb">
    <link rel="stylesheet" href="/simple-customizations.css?sha1=398af5fa50e4b2eb92a49bcd369425a11d399e5b">
  </head>
  <body>
    <header>
      <nav></nav>
      <h1>Frogtab Help</h1>
      <p>
        <a href="/" target="_blank">Frogtab</a> is a lightweight task manager that<br>
        helps you stay focused on today's priorities
      </p>
      <p>
        <a class="button" href="#overview-of-frogtab">Get Started</a>
      </p>
    </header>
    <main>
      <p>
        Thanks for exploring Frogtab!
        To get in touch, <a href="https://maybecoding.bearblog.dev" target="_blank">send a message</a> or <a href="mailto:feedback@frogtab.com">email me</a> üê∏
      </p>
      <article>
        <p class="before-compact">
          <strong>Getting Started</strong>
        </p>
        <ul class="compact">
          <li><a href="#overview-of-frogtab">Overview of Frogtab</a></li>
          <li><a href="#adding-tasks-to-your-inbox">Adding tasks to your inbox</a></li>
          <li><a href="#registering-for-a-personal-link">Registering for a personal link</a></li>
          <li><a href="#triaging-your-inbox">Triaging your inbox</a></li>
          <li><a href="#setting-up-recurring-tasks">Setting up recurring tasks</a></li>
        </ul>
        <p class="before-compact">
          <strong>Quick Reference</strong>
        </p>
        <ul class="compact">
          <li><a href="#keyboard-shortcuts">Keyboard shortcuts</a></li>
          <li><a href="#changing-the-theme">Changing the theme</a></li>
          <li><a href="#customizing-the-tab-icon">Customizing the tab icon</a></li>
          <li><a href="#exporting-your-data">Exporting your data</a></li>
          <li><a href="#importing-your-data">Importing your data</a></li>
        </ul>
        <p class="before-compact">
          <strong>Data Privacy</strong>
        </p>
        <ul class="compact">
          <li><a href="#overview-of-data-privacy">Overview of data privacy</a></li>
          <li><a href="#privacy-implications-of-registering">Privacy implications of registering</a></li>
        </ul>
      </article>
      <h2 id="overview-of-frogtab">Overview of Frogtab</h2>
      <p>
        <img class="light-only" alt="The Today view in Frogtab" src="/help-today-light.png" width="480">
        <img class="dark-only" alt="The Today view in Frogtab (dark theme)" src="/help-today-dark.png" width="480">
      </p>
      <p>
        <strong>Today</strong> is your to-do list for today.
        Start the day by writing down everything you'd like to accomplish.
        As you complete your tasks, simply delete them.
      </p>
      <p>
        <strong>Inbox</strong> is where you can capture any thoughts or potential tasks that arise during the day.
        To learn more, see <a href="#adding-tasks-to-your-inbox">Adding tasks to your inbox</a>.
      </p>
      <p>
        You can triage your inbox later in the day.
        As you triage your inbox, you'll delete or snooze each task.
        To learn more, see <a href="#triaging-your-inbox">Triaging your inbox</a>.
      </p>
      <p>
        Frogtab displays a notification badge to remind you to triage your inbox:
      </p>
      <p>
        <img class="light-only" alt="The Inbox view in Frogtab" src="/help-inbox-light.png" width="480">
        <img class="dark-only" alt="The Inbox view in Frogtab (dark theme)" src="/help-inbox-dark.png" width="480">
      </p>
      <p class="before-compact">
        At the beginning of each day, Frogtab automatically:
      </p>
      <ul class="compact">
        <li>Moves any remaining tasks from Today to your inbox</li>
        <li>Unsnoozes any snoozed tasks in your inbox</li>
        <li>Adds tasks from your <a href="#setting-up-recurring-tasks">weekly routine</a> to your inbox</li>
      </ul>
      <p>
        You can then triage your inbox and decide what you'd like to accomplish today.
      </p>
      <h2 id="adding-tasks-to-your-inbox">Adding tasks to your inbox</h2>
      <p>
        Frogtab makes it easy to capture any thoughts or potential tasks that arise as you're working through your priorities for the day.
        You don't need to fill in lots of information when you capture a task - you can add the task to your inbox without getting distracted.
      </p>
      <p>
        To add a task to your inbox, use either of the following methods:
      </p>
      <ul>
        <li>
          <p>
            Write down the task in your inbox.
          </p>
        </li>
        <li>
          <p>
            Open <a href="/send" target="_blank">Send to Frogtab</a> in a new tab, then write down the task and click the send button.
            This method is great if you want to capture the task without revealing your inbox (e.g., during a meeting).
          </p>
        </li>
      </ul>
      <p>
        By default, Send to Frogtab doesn't work from other devices.
        If you want to capture tasks from other devices, you must first register for a personal link.
      </p>
      <h2 id="registering-for-a-personal-link">Registering for a personal link</h2>
      <p>
        If you choose to register this device, you'll get a personal link that you can use to send tasks to Frogtab from any device.
      </p>
      <div class="notice display">
        <div id="case-checking" class="display">
          <p>
            Checking this device‚Ä¶
          </p>
        </div>
        <div id="case-unregistered">
          <p>
            You have not registered this device.
            To register this device, please share your experience of using Frogtab - thank you!
          </p>
          <div>
            <input id="comment" style="width: 100%" type="text" placeholder="Your experience‚Ä¶">
          </div>
          <div>
            <button id="register" disabled>Send &amp; Register</button>
          </div>
          <p>
            <a href="#privacy-implications-of-registering">Learn about data privacy</a>
          </p>
        </div>
        <div id="case-registering">
          <p>
            Registering this device‚Ä¶
          </p>
        </div>
        <div id="case-registered">
          <p>
            You have registered this device.
          </p>
          <div>
            <button id="link">Open My Personal Link</button>
          </div>
          <p>
            <a href="#privacy-implications-of-registering">Learn about data privacy</a>
          </p>
          <p>
            <a href="#" id="start-forget">Forget this device</a>
          </p>
        </div>
        <div id="case-registered-forget">
          <p>
            Frogtab will forget this device when you
            <a href="#" id="forget" title="Forget This Device">click here</a>.
          </p>
          <p>
            Your personal link will be permanently deactivated.
            To send tasks to Frogtab from any device, you'll need to re-register this device and get a new personal link.
          </p>
          <div>
            <button id="cancel-forget">Don't Forget This Device</button>
          </div>
        </div>
        <div id="case-forgetting">
          <p>
            Forgetting this device‚Ä¶
          </p>
        </div>
      </div>
      <p>
        If this device is registered, you'll see a cloud icon at the top of Frogtab.
        The cloud icon means that Frogtab is ready to receive tasks from your personal link.
      </p>
      <p>
        More details about your personal link:
      </p>
      <ul>
        <li>
          <p>
            Anyone who knows your personal link can send tasks to your inbox.
          </p>
        </li>
        <li>
          <p>
            Tasks may take up to 10 minutes to appear in your inbox.
            To force Frogtab to check for new tasks, reload Frogtab.
          </p>
        </li>
        <li>
          <p>
            If you clear your browsing data, your personal link will stop working.
            To reactivate your personal link, <a href="#importing-your-data">import your Frogtab data</a>
            (assuming that you've previously <a href="#exporting-your-data">made a backup</a>).
            Or you can re-register this device and get a new personal link.
          </p>
        </li>
      </ul>
      <h2 id="triaging-your-inbox">Triaging your inbox</h2>
      <p>
        The purpose of triaging your inbox is to make a decision about how to act on each of the tasks that you've captured.
      </p>
      <p>
        To triage your inbox, take one of the following actions for each task in your inbox:
      </p>
      <ul>
        <li>
          <p>
            Complete the task immediately, then delete it.
          </p>
        </li>
        <li>
          <p>
            Move the task to Today if you plan to work on it later the same day.
          </p>
        </li>
        <li>
          <p>
            Snooze the task by writing # in front of the task:
          </p>
          <p>
            <img class="light-only" alt="The Inbox view in Frogtab, with a snoozed task" src="/help-snoozed-light.png" width="480">
            <img class="dark-only" alt="The Inbox view in Frogtab, with a snoozed task (dark theme)" src="/help-snoozed-dark.png" width="480">
          </p>
          <p>
            Frogtab will unsnooze the task at the beginning of the next day.
          </p>
        </li>
        <li>
          <p>
            Move the task to a more appropriate location outside Frogtab (e.g., a calendar event or a topic in a meeting agenda).
          </p>
        </li>
        <li>
          <p>
            Delete the task if it's not particularly important.
          </p>
        </li>
      </ul>
      <p>
        As soon as you've triaged your inbox, Frogtab's notification badge disappears.
      </p>
      <h2 id="setting-up-recurring-tasks">Setting up recurring tasks</h2>
      <p>
        If there are tasks that you usually do on the same day each week, Frogtab can automatically add the tasks to your inbox at the beginning of the appropriate day.
      </p>
      <p>
        To set up recurring tasks:
      </p>
      <ol>
        <li>
          <p>
            Open <a href="/week" target="_blank">Weekly Routine</a> in a new tab.
          </p>
        </li>
        <li>
          <p>
            Select a day, then write down your recurring tasks for that day. For example:
          </p>
          <blockquote>
            Mon&nbsp; Tue&nbsp; <strong>Wed</strong>&nbsp; Thu&nbsp; Fri&nbsp; Sat&nbsp; Sun
            <hr>
            Prepare for this week's Wild Wednesday!
          </blockquote>
          <p>
            If you usually plan each day the night before, write down your recurring tasks under the previous day too,
            with # in front of each task. For example:
          </p>
          <blockquote>
            Mon&nbsp; <strong>Tue</strong>&nbsp; Wed&nbsp; Thu&nbsp; Fri&nbsp; Sat&nbsp; Sun
            <hr>
            # Prepare for this week's Wild Wednesday!
          </blockquote>
          <p>
            You'll then be able to see the tasks one day in advance.
            When Frogtab adds the tasks to your inbox, they'll be snoozed (because of the #), so they won't cause Frogtab to display a notification badge.
          </p>
        </li>
      </ol>
      <p>
        After you've finished writing down your recurring tasks, close the tab.
      </p>
      <h2 id="keyboard-shortcuts">Keyboard shortcuts</h2>
      <p>
        <label>
          <input id="os-mac" type="radio" name="os" checked> macOS
        </label>
        <label>
          <input id="os-win-linux" type="radio" name="os"> Windows/Linux
        </label>
      </p>
      <table>
        <thead>
          <tr>
            <th style="width: 68%">Action</th>
            <th style="width: 32%">Shortcut</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <p>
                Start a new line at the top
              </p>
            </td>
            <td>
              <span class="shortcut mac display"><kbd>‚åò</kbd> + <kbd>Enter</kbd></span>
              <span class="shortcut win-linux"><kbd>Ctrl</kbd> + <kbd>Enter</kbd></span>
            </td>
          </tr>
          <tr>
            <td>
              <p>
                Show Today
              </p>
            </td>
            <td>
              <span class="shortcut mac display"><kbd>‚åò</kbd> + <kbd>U</kbd></span>
              <span class="shortcut win-linux"><kbd>Ctrl</kbd> + <kbd>U</kbd></span>
            </td>
          </tr>
          <tr>
            <td>
              <p>
                Show Inbox
              </p>
            </td>
            <td>
              <span class="shortcut mac display"><kbd>‚åò</kbd> + <kbd>I</kbd></span>
              <span class="shortcut win-linux"><kbd>Ctrl</kbd> + <kbd>I</kbd></span>
            </td>
          </tr>
          <tr>
            <td>
              <p>
                Show Inbox and select all unsnoozed tasks
              </p>
            </td>
            <td>
              <span class="shortcut mac display"><kbd>‚åò</kbd> + <kbd>Shift</kbd> + <kbd>I</kbd></span>
              <span class="shortcut win-linux"><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>I</kbd></span>
            </td>
          </tr>
          <tr>
            <td>
              <p>
                Move selected tasks from Inbox to Today
              </p>
              <p>
                If the tasks are snoozed, Frogtab unsnoozes them.
              </p>
            </td>
            <td>
              <span class="shortcut mac display"><kbd>‚åò</kbd> + <kbd>Shift</kbd> + <kbd>Enter</kbd></span>
              <span class="shortcut win-linux"><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>Enter</kbd></span>
            </td>
          </tr>
          <tr>
            <td>
              <p>
                Snooze selected tasks
              </p>
              <p>
                If the tasks are in Today, Frogtab moves them to Inbox.
              </p>
            </td>
            <td>
              <span class="shortcut mac display"><kbd>‚åò</kbd> + <kbd>/</kbd></span>
              <span class="shortcut win-linux"><kbd>Ctrl</kbd> + <kbd>/</kbd></span>
            </td>
          </tr>
          <tr>
            <td>
              <p>
                Toggle editing position between center and bottom
              </p>
              <p>
                Also accessible via
                <strong>Snap to Bottom</strong> or <strong>Snap to Center</strong> from the
                <svg width="20px" height="20px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="currentColor"><path d="M3 5h18M3 12h18M3 19h18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                menu.
                This feature is handy for making room for other windows, such as video calls.
              </p>
            </td>
            <td>
              <span class="shortcut mac display"><kbd>‚åò</kbd> + <kbd>B</kbd></span>
              <span class="shortcut win-linux"><kbd>Ctrl</kbd> + <kbd>B</kbd></span>
            </td>
          </tr>
        </tbody>
      </table>
      <p>
        For <a href="/send" target="_blank">Send to Frogtab</a>:
      </p>
      <table>
        <thead>
          <tr>
            <th style="width: 68%">Action</th>
            <th style="width: 32%">Shortcut</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <p>
                Send
              </p>
            </td>
            <td>
              <span class="shortcut mac display"><kbd>‚åò</kbd> + <kbd>Enter</kbd></span>
              <span class="shortcut win-linux"><kbd>Ctrl</kbd> + <kbd>Enter</kbd></span>
            </td>
          </tr>
        </tbody>
      </table>
      <h2 id="changing-the-theme">Changing the theme</h2>
      <p>
        By default, Frogtab matches your system's light/dark setting.
        If you prefer to always use a particular theme, you can override the default behavior.
      </p>
      <div class="notice display">
        <div class="display">
          <p>
            Select a theme:
          </p>
          <div>
            <label>
              <input id="theme-light" type="radio" name="theme"> Light
            </label>
            <label>
              <input id="theme-dark" type="radio" name="theme"> Dark
            </label>
            <label>
              <input id="theme-system" type="radio" name="theme" checked> System
            </label>
          </div>
        </div>
      </div>
      <h2 id="customizing-the-tab-icon">Customizing the tab icon</h2>
      <p>
        Whenever Frogtab displays a notification badge, Frogtab tries to put a badge on the tab icon too.
        Some browsers (e.g., Safari) don't support this feature. If you want this feature, you'll need to use a workaround.
      </p>
      <p>
        To enable the workaround, use <a href="/icon-normal?reload=start" target="_blank">this version of Frogtab</a>.
        Frogtab will periodically reload itself to update the tab icon.
        When Frogtab reloads itself, your undo history will be lost. Frogtab will only reload itself when the tab isn't active.
      </p>
      <p>
        If your browser supports Frogtab's default way of updating the tab icon, but you prefer no badge on the tab icon, you can use <a href="/icon-normal" target="_blank">this version of Frogtab</a>.
      </p>
      <h2 id="exporting-your-data">Exporting your data</h2>
      <p>
        Your data is stored in your browser.
        If you like, you can make a backup of your data by exporting your data in JSON format.
      </p>
      <p>
        To export your data, click
        <svg width="20px" height="20px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="currentColor"><path d="M3 5h18M3 12h18M3 19h18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
        at the bottom of Frogtab, then click <strong>Export My Data</strong>.
      </p>
      <p>
        Some browsers are able to directly write to files on your device.
        If your browser supports this feature, Frogtab can automatically back up your data whenever your data changes.
        To start automatically backing up your data, click <strong>Enable Auto-Backup</strong> at the bottom of Frogtab.
      </p>
      <h2 id="importing-your-data">Importing your data</h2>
      <p>
        If you've previously made a backup of your data, you can restore your data.
      </p>
      <p>
        To start the restore process, <a href="#" id="start-restore">open a backup file</a>.
      </p>
      <input type="file" id="choose-backup-file" style="display: none" accept=".json">
      <div id="staged-restore" class="notice">
        <div class="display">
          <p>
            Frogtab will restore your data from <strong id="restore-date"></strong> when you next reload Frogtab.
          </p>
          <div>
            <button id="cancel-restore">Don't Restore My Data</button>
          </div>
        </div>
      </div>
      <h2 id="overview-of-data-privacy">Overview of data privacy</h2>
      <p class="before-compact">
        Frogtab stores the following data that you create:
      </p>
      <ul class="compact">
        <li>The contents of Today and Inbox</li>
        <li>Recurring tasks from your weekly routine</li>
      </ul>
      <p>
        Your data is stored in your browser and isn't sent to a server.
        If you like, you can make a backup of your data.
        To learn more, see <a href="#exporting-your-data">Exporting your data</a>.
      </p>
      <p>
        If you choose to register this device, you'll get a personal link that you can use to send tasks to Frogtab from any device.
        To learn more, see <a href="#registering-for-a-personal-link">Registering for a personal link</a> and <a href="#privacy-implications-of-registering">Privacy implications of registering</a>.
      </p>
      <p>
        Frogtab doesn't use cookies, collect PII, serve ads, or track you in any way.
      </p>
      <h2 id="privacy-implications-of-registering">Privacy implications of registering</h2>
      <p>
        If you choose to register this device, Frogtab generates identification and encryption credentials for this device. The credentials are stored in your browser and are included if you make a backup of your data.
      </p>
      <p>
        The credentials are also stored on a server, with the exception of a private key that Frogtab uses to decrypt tasks received from your personal link.
        You can delete the credentials from the server at any time.
        To delete the credentials, go to <a href="#registering-for-a-personal-link">Registering for a personal link</a>, then click <strong>Forget this device</strong>.
      </p>
      <p>
        More details about how your personal link works:
      </p>
      <ul>
        <li>
          <p>
            When you use your personal link to send a task to Frogtab, the task is first encrypted on the sending device.
            The encrypted task is then sent to the server.
          </p>
        </li>
        <li>
          <p>
            Only this device is permitted to download the encrypted task from the server.
            After downloading the encrypted task, Frogtab decrypts the task using a private key that never leaves this device.
          </p>
        </li>
        <li>
          <p>
            The server deletes the encrypted task as soon as it has been downloaded.
          </p>
        </li>
      </ul>
      <p>
        For technical details, see <a href="https://github.com/dwilding/frogtab#data-flow" target="_blank">Data flow</a> in GitHub.
      </p>
    </main>
    <footer>
      <p>
        Frogtab is a free app developed by <a href="https://github.com/dwilding" target="_blank">Dave Wilding</a>.
        It's designed to be stable over many years and inexpensive for me to operate. 
        I hope that Frogtab brings joy to your day!
      </p>
      <p>
        Acknowledgments:
        <a href="https://simplecss.org" target="_blank">Simple.css</a>,
        <a href="https://openpgpjs.org" target="_blank">OpenPGP.js</a>,
        <a href="https://uuid.ramsey.dev" target="_blank">ramsey/uuid</a>,
        <a href="https://iconoir.com" target="_blank">iconnoir</a>,
        <a href="https://www.fiverr.com/mackwhyte" target="_blank">mackwhyte</a>
      </p>
      <p>
        <a href="https://github.com/dwilding/frogtab" target="_blank">Source code</a>
        ‚Ä¢
        <a href="https://maybecoding.bearblog.dev/blog/" target="_blank">Dev blog</a>
      </p>
    </footer>
    <script>
      function updateSelectedTheme() {
        if (localStorage.getItem("ui.theme") == "light") {
          dom.themeLight.checked = true;
        }
        else if (localStorage.getItem("ui.theme") == "dark") {
          dom.themeDark.checked = true;
        }
        else {
          dom.themeSystem.checked = true;
        }
      }
      function delayForUX(f) {
        return Promise.all([
          f(),
          new Promise(resolve => window.setTimeout(resolve, 1500))
        ]);
      }
      async function verify() {
        await delayForUX(async () => {
          if (localStorage.getItem("user.userID") === null) {
            return;
          }
          let response;
          try {
            response = await fetch("/post-verify-user", {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                user_id: localStorage.getItem("user.userID"),
                api_key: localStorage.getItem("user.apiKey")
              })
            });
          }
          catch (err) {
            return;
          }
          if (!response.ok) {
            return;
          }
          const result = await response.json();
          verifiedUser = result.success;
        });
        dom.caseChecking.classList.remove("display");
        if (verifiedUser) {
          dom.caseRegistered.classList.add("display");
          dom.link.addEventListener("click", event => {
            window.open(`/send#${localStorage.getItem("user.userID")}`, "_blank");
          });
        }
        else {
          dom.caseUnregistered.classList.add("display");
        }
      }
      async function register() {
        dom.caseUnregistered.classList.remove("display");
        dom.caseRegistering.classList.add("display");
        await delayForUX(async () => {
          if (openpgp === undefined) {
            openpgp = await import("/openpgp.min.mjs?sha1=37c26b5e680e0824cde10d4ff7888cac49606a8d");
          }
          const encryptedComment = await openpgp.encrypt({
            message: await openpgp.createMessage({
              text: `Registration: ${dom.comment.value}`
            }),
            encryptionKeys: await openpgp.readKey({
              armoredKey: "-----BEGIN PGP PUBLIC KEY BLOCK-----\n\nxjMEZC0XTRYJKwYBBAHaRw8BAQdAQGn1uwsmrmyNDjJEpBItytslxrvK0Iym\nKrSeCQaWOv7NNzx1c2VyXzAzYWU2YjZmLTExMzQtNGU3Yi04M2VkLWRlYWFl\nNGI1M2FmN0Bmcm9ndGFiLmNvbT7CjAQQFgoAPgWCZC0XTQQLCQcICZDHWnmD\n1b6y2wMVCAoEFgACAQIZAQKbAwIeARYhBOsq7cBWQAUaO3W7VMdaeYPVvrLb\nAACwZQD+J8iHCcZwYwO3U/5dUu0fKR9iCInWlFk23UTgzUFkCS4BAILb2Xzy\nMORtPHGaBqUP0v7XbnnigyCwC2zg1JiJ5bIOzjgEZC0XTRIKKwYBBAGXVQEF\nAQEHQCbGVL7Nh+2kYvX2W6FTK7f/n7Fo7OclmEOS3xjUzEs0AwEIB8J4BBgW\nCAAqBYJkLRdNCZDHWnmD1b6y2wKbDBYhBOsq7cBWQAUaO3W7VMdaeYPVvrLb\nAABb/gEApI8wmO4HQ82pTMg2POA/AT85AseK3lv4ds1Mz6W5p48A/jbtMsAG\nn5seyoPf02oOSmPmNr7OhtP/19HeoY6Sj1IG\n=PY9A\n-----END PGP PUBLIC KEY BLOCK-----\n"
            })
          });
          const pgpKey = await openpgp.generateKey({
            userIDs: [{
              email: `key+${crypto.randomUUID()}@frogtab.com`
            }]
          });
          let response;
          try {
            response = await fetch("/post-create-user", {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                pgp_public_key: pgpKey.publicKey,
                comment: encryptedComment
              })
            });
          }
          catch (err) {
            return;
          }
          if (!response.ok) {
            return;
          }
          const result = await response.json();
          verifiedUser = result.success;
          if (!verifiedUser) {
            return;
          }
          localStorage.setItem("user.pgpPublicKey", pgpKey.publicKey);
          localStorage.setItem("user.pgpPrivateKey", pgpKey.privateKey);
          localStorage.setItem("user.apiKey", result.user.api_key);
          localStorage.setItem("user.userID", result.user.user_id); // Update userID last because other tabs may be watching
        });
        dom.caseRegistering.classList.remove("display");
        if (verifiedUser) {
          dom.comment.value = "";
          dom.register.disabled = true;
          dom.caseRegistered.classList.add("display");
          dom.link.addEventListener("click", event => {
            window.open(`/send#${localStorage.getItem("user.userID")}`, "_blank");
          });
        }
        else {
          dom.caseUnregistered.classList.add("display");
        }
      }
      async function forget() {
        dom.caseRegisteredForget.classList.remove("display");
        dom.caseForgetting.classList.add("display");
        await delayForUX(async () => {
          let response;
          try {
            response = await fetch("/post-remove-user", {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                user_id: localStorage.getItem("user.userID"),
                api_key: localStorage.getItem("user.apiKey")
              })
            });
          }
          catch (err) {
            return;
          }
          if (!response.ok) {
            return;
          }
          const result = await response.json();
          verifiedUser = !result.success;
          if (verifiedUser) {
            return;
          }
          localStorage.removeItem("user.userID"); // Update userID first because other tabs may be watching
          localStorage.removeItem("user.apiKey");
          localStorage.removeItem("user.pgpPrivateKey");
          localStorage.removeItem("user.pgpPublicKey");
        });
        dom.caseForgetting.classList.remove("display");
        if (verifiedUser) {
          dom.caseRegistered.classList.add("display");
        }
        else {
          dom.caseUnregistered.classList.add("display");
        }
      }
      function tryToStageRestore(backupJSON) {
        let backupData;
        try {
          backupData = JSON.parse(backupJSON);
        }
        catch (err) {
          return;
        }
        if (!("date" in backupData)) {
          return;
        }
        localStorage.setItem("restore", backupJSON);
        setRestoreStatus(backupData);
      }
      function setRestoreStatus(backupData) {
        const backupDate = (new Date(backupData.date)).toLocaleDateString(undefined, {
          day: "numeric",
          month: "short",
          year: "numeric"
        });
        dom.stagedRestore.classList.add("display");
        dom.restoreDate.textContent = backupDate;
        dom.cancelRestore.addEventListener("click", event => {
          localStorage.removeItem("restore");
          dom.stagedRestore.classList.remove("display");
        });
      }
      async function startApp() {
        verify();
        updateSelectedTheme();
        dom.themeLight.addEventListener("change", event => {
          document.documentElement.setAttribute("data-theme", "light");
          localStorage.setItem("ui.theme", "light");
        });
        dom.themeDark.addEventListener("change", event => {
          document.documentElement.setAttribute("data-theme", "dark");
          localStorage.setItem("ui.theme", "dark");
        });
        dom.themeSystem.addEventListener("change", event => {
          document.documentElement.setAttribute("data-theme", "system");
          localStorage.setItem("ui.theme", "system");
        });
        if (!(
          navigator.platform.includes("Mac")
          || navigator.platform.includes("iPad")
          || navigator.platform.includes("iPhone")
        )) {
          dom.osWinLinux.checked = true;
          for (const shortcut of document.querySelectorAll(".shortcut.mac")) {
            shortcut.classList.remove("display");
          }
          for (const shortcut of document.querySelectorAll(".shortcut.win-linux")) {
            shortcut.classList.add("display");
          }
        }
        dom.osWinLinux.addEventListener("change", event => {
          for (const shortcut of document.querySelectorAll(".shortcut.mac")) {
            shortcut.classList.remove("display");
          }
          for (const shortcut of document.querySelectorAll(".shortcut.win-linux")) {
            shortcut.classList.add("display");
          }
        });
        dom.osMac.addEventListener("change", event => {
          for (const shortcut of document.querySelectorAll(".shortcut.win-linux")) {
            shortcut.classList.remove("display");
          }
          for (const shortcut of document.querySelectorAll(".shortcut.mac")) {
            shortcut.classList.add("display");
          }
        });
        dom.comment.addEventListener("input", event => {
          dom.register.disabled = (dom.comment.value.trim() == "");
        });
        dom.comment.addEventListener("keydown", event => {
          if (!dom.register.disabled && "key" in event && event.key.toLowerCase() == "enter") {
            register();
          }
        });
        dom.register.addEventListener("click", event => {
          register();
        });
        dom.startForget.addEventListener("click", event => {
          event.preventDefault();
          dom.caseRegistered.classList.remove("display");
          dom.caseRegisteredForget.classList.add("display");
        });
        dom.forget.addEventListener("click", async event => {
          event.preventDefault();
          forget();
        });
        dom.cancelForget.addEventListener("click", event => {
          dom.caseRegisteredForget.classList.remove("display");
          dom.caseRegistered.classList.add("display");
        });
        if (localStorage.getItem("restore") !== null) {
          setRestoreStatus(JSON.parse(localStorage.getItem("restore")));
        }
        dom.startRestore.addEventListener("click", event => {
          event.preventDefault();
          dom.chooseBackupFile.click();
        });
        dom.chooseBackupFile.addEventListener("change", event => {
          const backupFile = dom.chooseBackupFile.files[0];
          if (backupFile === undefined) {
            return;
          }
          const backupFileReader = new FileReader();
          backupFileReader.onload = event => {
            tryToStageRestore(backupFileReader.result);
          };
          backupFileReader.readAsText(backupFile);
          dom.chooseBackupFile.value = "";
        });
        window.addEventListener("storage", event => {
          document.documentElement.setAttribute("data-theme", localStorage.getItem("ui.theme"));
          updateSelectedTheme();
          if (
            (
              dom.stagedRestore.classList.contains("display")
              && localStorage.getItem("restore") === null
            )
            || (
              !dom.stagedRestore.classList.contains("display")
              && localStorage.getItem("restore") !== null
            )
          ) {
            window.location.reload();
          }
        });
      }

      // ******** Initial setup ********
      if (localStorage.getItem("ui.theme") === null) {
        localStorage.setItem("ui.theme", "system");
      }
      document.documentElement.setAttribute("data-theme", localStorage.getItem("ui.theme"));
      const dom = {
        themeLight: document.getElementById("theme-light"),
        themeDark: document.getElementById("theme-dark"),
        themeSystem: document.getElementById("theme-system"),
        osMac: document.getElementById("os-mac"),
        osWinLinux: document.getElementById("os-win-linux"),
        caseChecking: document.getElementById("case-checking"),
        caseUnregistered: document.getElementById("case-unregistered"),
        caseRegistering: document.getElementById("case-registering"),
        caseRegistered: document.getElementById("case-registered"),
        caseRegisteredForget: document.getElementById("case-registered-forget"),
        caseForgetting: document.getElementById("case-forgetting"),
        comment: document.getElementById("comment"),
        register: document.getElementById("register"),
        link: document.getElementById("link"),
        startForget: document.getElementById("start-forget"),
        forget: document.getElementById("forget"),
        cancelForget: document.getElementById("cancel-forget"),
        startRestore: document.getElementById("start-restore"),
        chooseBackupFile: document.getElementById("choose-backup-file"),
        stagedRestore: document.getElementById("staged-restore"),
        restoreDate: document.getElementById("restore-date"),
        cancelRestore: document.getElementById("cancel-restore")
      };
      let verifiedUser = false;
      let openpgp;
      startApp();
    </script>
  </body>
</html>