<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capture - Frogtab</title>
    <link rel="icon" href="/icon.svg" type="image/svg+xml" id="icon">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="stylesheet" href="/style.css">
  </head>
  <body>
    <div class="container">
      <div class="interface">
        <div class="tabs">
          <div class="tab">
            <span class="tab-name selected">Capture</span>
          </div>
          <div class="tab info">
            <span id="tab-info" class="info-message">Press Enter to add to your inbox</span>
          </div>
        </div>
        <div class="main">
          <textarea id="editor" class="capture"></textarea>
        </div>
      </div>
    </div>
    <script>
      const dom = {
        editor: document.getElementById("editor"),
        tabs: {
          info: document.getElementById("tab-info")
        }
      };
      dom.editor.addEventListener("input", event => {
        const value = dom.editor.value.trim();
        if (value != "") {
          dom.tabs.info.classList.add("visible");
        }
        else {
          dom.tabs.info.classList.remove("visible");
        }
      });
      function appendToInbox(value) {
        const valueToAppend = value.trim();
        if (valueToAppend == "") {
          return false;
        }
        let valueInbox = localStorage.getItem("value.inbox").trimStart();
        if (valueInbox != "") {
          valueInbox = `\n\n${valueInbox}`;
        }
        valueInbox = `${valueToAppend}${valueInbox}`;
        localStorage.setItem("value.inbox", valueInbox);
        return true;
      }
      document.body.addEventListener("keydown", event => {
        if (event.key.toLowerCase() == 'enter') {
          event.preventDefault();
          if (appendToInbox(dom.editor.value)) {
            dom.editor.value = "";
            dom.editor.focus();
            dom.tabs.info.classList.remove("visible");
          }
        }
      });
      if (localStorage.length == 0) {
        localStorage.setItem("value.today", "");
        localStorage.setItem("value.inbox", "");
        localStorage.setItem("date", (new Date().toDateString()));
      }
      editor.focus();
    </script>
  </body>
</html>